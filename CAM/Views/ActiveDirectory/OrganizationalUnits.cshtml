@using CAM.Helpers
@model AdOuViewModel

@{
    ViewBag.Title = "Active Directory Organizational Units";
}

<h2 class="page-header">Active Directory Organizational Units</h2>

@using(Html.BeginForm("OrganizationalUnits", "ActiveDirectory", FormMethod.Post, new {@class="form-horizontal"}))
{
    @Html.AntiForgeryToken()
    
    if(Model == null)
    {
        @Html.Partial("_AdAuthForm", "Authorize")    
    }
    else if(!Model.AdOuCompares.Any())
    {
        <div class="alert alert-info">
            <p>
                The system is in sync with your Active Directory.  No changes have been found.
            </p>
        </div>
    }
    else
    {
        <table class="table table-striped">
            <thead>
                <tr>
                    <th></th>
                    <th>Name</th>
                    <th>Path</th>
                    <th>Change Type</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var row in Model.AdOuCompares)
                {
                    <tr>
                        <td>
                            @if (row.ChangeType == ChangeType.Add)
                            {
                                <div class="btn btn-success adaction" data-action="add"><i class="icon-plus"></i>Add</div>
                                <input type="checkbox" value="@row.Path" checked="checked" name="add"/>
                            }
                            else if (row.ChangeType == ChangeType.Update)
                            {
                                <div class="btn btn-warning adaction" data-action="update"><i class="icon-refresh"></i>Update</div>
                                <input type="checkbox" value="@row.Path" checked="checked" name="update"/>
                            }
                            else if (row.ChangeType == ChangeType.Remove)
                            {
                                <div class="btn btn-danger adaction" data-action="remove"><i class="icon-minus"></i>Remove</div>
                                <input type="checkbox" value="@row.Path" checked="checked" name="remove"/>
                            }
                        </td>
                        <td>@row.Name</td>
                        <td>@row.Path</td>
                        <td>@row.ChangeType</td>
                    </tr>
                }
            </tbody>
        </table>
    
        @Html.Partial("_AdAuthForm", "Submit")
    }
}

@section scripts
{
    <style type="text/css">
        input[type='checkbox'] { display: none;}
    </style>

    <script type="text/javascript">
        $(function () {
            $(".adaction").click(function () {
                
                if ($(this).hasClass("btn-inverse")) {
                    $(this).removeClass("btn-inverse");
                    if ($(this).data("action") == "add") {
                        $(this).addClass("btn-success");
                    }
                    if ($(this).data("action") == "update") {
                        $(this).addClass("btn-warning");
                    }
                    if ($(this).data("action") == "remove") {
                        $(this).addClass("btn-danger");
                    }
                } else {
                    $(this).removeClass("btn-success btn-warning btn-danger");
                    $(this).addClass("btn-inverse");
                }

            });
        });
    </script>
}